<html>
<head>
    
<!--CDNs for highcharts
    Will be rate limited if overused

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/networkgraph.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
-->
    <script src="./public/js/highcharts.js"> </script>
    <script src="./public/js/networkgraph.js"></script>
    <script src="./public/js/accessibility.js"></script>
    <script src="./public/js/exporting.js"></script>
    <script src="./public/js/export-data.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            margin: 0;
            font-size: 1rem; /* Base font size */
        }
        figure {
            margin: 0;
            margin-block-start: 0;
            margin-block-end: 0;
            margin-inline-start: 0;
            margin-inline-end: 0;
        }
        br {
            display: block;
            margin: 0.3125rem 0; /* 5px converted to rem */
        }

        #container {
            width: 100%;
            height: 95vh;
            margin: 0 auto;
            overflow: hidden;
            font-size: 1rem; /* Changed from 2em to 1rem */
        }
        .highcharts-tooltip span {
            pointer-events: auto;
            padding: 0.375rem; /* 6px converted to rem */
            min-width: 18.75rem; /* 300px converted to rem */
            max-width: 25rem !important; /* 400px converted to rem */
            word-wrap: break-word !important;
            word-break: break-word !important;
            white-space: normal !important;
            display: block !important;
            box-sizing: border-box !important;
        }

        .highcharts-point {
            cursor: grab;
        }
        
        .highcharts-point:active {
            cursor: grabbing;
        }

        @media screen and (max-width: 48rem) { /* 768px converted to rem */
            #container {
                height: 90vh;
                font-size: 0.875rem; /* Smaller base font for mobile */
            }
            .highcharts-tooltip span {
                min-width: 15rem; /* 240px converted to rem */
                max-width: 20rem !important; /* 320px converted to rem */
            }
        }
    </style>
</head>

<body>
    <figure>
        <div id="container">
        </div>
        <p class="highcharts-description" style="display:none;">
            The following chart demonstrates some of the relationships between Career Center programs and stakeholder populations. The network graph visualizes relationships between entities, represented as nodes (points) and edges (lines connecting the points). In this example, the network graph illustrates the connections between various populations (such as Industry, Alumni, Faculty, Students, Employers, and Parents) and programs (like Career Committee, KEY Careers, Skills Infusion, Faculty Externships, Indiana Connection Lounge, Practice Interview, On Campus Student Employment, Competency Measures, Experience Journal, County Ambassadors, Social Capital Building, and Job Fairs) within the Career Center Ecosystem. Users can interact with the graph by clicking on population nodes to reveal their connections to relevant programs. The layout is dynamic and adjusts based on user interactions.
        </p>
    </figure>
    <script>
        
        // Highcharts configuration
        var G000 = "#33ffbd";
        var card = "#BA0C2F";
        var darkred = "#79242F";
        var black = "#000000";
        var dgray = "#54585A";
        var lgray = "#E6E7E8";
        var white = "#FFFFFF";

        const colorLegend = [
            { color: "#BA0C2F", name: 'Populations' },
            { color: "#E6E7E8", name: 'Programs' },
        ];

        Highcharts.theme = {
            colors: [G000, card, darkred, black, dgray, lgray, white],
            chart: {
                backgroundColor: white,
                style: {
                    fontFamily: 'Open Sans, Arial, sans-serif',
                    fontSize: '1em'
                }
            },
            title: {
                style: {
                    color: black
                }
            },  
            subtitle: {
                style: {
                    color: black,
                }
            }
        };
        Highcharts.setOptions(Highcharts.theme);

        Highcharts.chart('container', {
            chart: {
                type: 'networkgraph',
                marginTop: 80,
                events: {
                    afterRender() {
                        this.series.forEach(s => {
                            if (s.points) {
                                s.points.forEach(p=> {
                                    p.graphic.element.removeAttribute('aria-hidden')
                                })
                            }
                        }); 
                    }
                },
                
            },
            legend: {
                enabled: true,
                floating: true,
                align: 'left',
                verticalAlign: 'top',
                layout: 'vertical',
                events: {
                    itemClick: function () {
                        return false;
                    }
                }
            },
            style: {
                backgroundColor: dgray,
                fontFamily: 'monospace',
                fontSize: '16px'
            },
            title: {
                enabled: false,
                text: null
            },
            credits: { enabled: false },
            exporting: {
                buttons: {
                    contextButton: {
                        menuItems: [
                            'viewFullscreen',
                        ]
                    }
                }
            },
            plotOptions: {
                networkgraph: {
                    keys: ['from', 'to', 'color'],
                    draggable: true,
                    layoutAlgorithm: {
                        enableSimulation: true,
                        linkLength: 200,
                        integration: 'verlet',
                        friction: -0.90,
                        maxSpeed: 200,
                        maxIterations: 700,
                        initialPositions: 'circle'
                    },
                    animation: {
                        duration: 500
                    }
                }
            },
            tooltip: {
                useHTML: true,
                style: {
                    fontSize: '0.875rem', /* Changed from 0.5em to rem */
                    textAlign: 'center',
                    overflow: 'none',
                    pointerEvents: 'auto'
                },
                formatter: function () {
                    const additionalInfo = {
                        'Industry':'Various sectors of the economy.',
                        'Alumni':'Graduates of the university.',
                        'Faculty':'Educators and academic staff.',
                        'Students':'Individuals seeking education and career opportunities.',
                        'Employers':'Organizations providing job opportunities.',
                        'Parents':'Parents, guardians, and family of students.',
                        'All Populations':'A collective term for all stakeholders in the ecosystem.',
                        'Career Committee': 'Connects families directly with the university\'s career development efforts by channeling their insight and support into initiatives that expand student opportunities and strengthen employer relationships.',
                        'KEY Careers': 'Accelerates student readiness and postgraduation outcomes by guiding early exploration, reducing uncertainty, and connecting academic experiences to real-world career goals.',
                        'Skills Infusion': 'Aligns classroom learning with career readiness by bringing faculty, alumni, and employers together to integrate in-demand workplace competencies into student learning outcomes.',
                        'Faculty Externships': 'Bridges academia and industry by embedding faculty in industry environments, enabling faculty to connect with industry and bring current, career-relevant insights back into the classroom.',
                        'Indiana Connection Lounge': 'Activates one-on-one and small-group introductions between students, alumni, and employers in a relaxed, approachable environment, creating intentional, relationship-based pathways to internships and jobs.',
                        'Practice Interview': 'Equips students with confidence and strategy by offering hands-on practice interviews that simulate real scenarios and sharpen professional communication skills, delivered by employers and alumni.',
                        'On Campus Student Employment': 'An on-campus job is more than a job, it is skill development and training for the workplace while providing Ball State departments with adaptable talent that helps drive innovation and operations.',
                        'Competency Measures': 'Tracks and reinforces students\' career readiness by embedding and assessing NACE Career Competencies across programs, helping students articulate their strengths to employers.',
                        'Experience Journal': 'Empowers students to reflect and articulate how they\'re building core competencies through academic, co-curricular, and work-based experiences.',
                        'County Ambassadors': 'Builds pride and peer-to-peer engagement by empowering students to promote their hometowns and foster meaningful connections across Indiana\'s diverse communities.',
                        'Social Capital Building': 'Helps students build the necessary skills to strategically build connections and relationships to fully leverage their higher education and form lasting connections that unlock career opportunities.',
                        'Job Fairs': 'Drives employment outcomes by hosting events that directly connect students with hiring employers, contributing to Ball State\'s high placement rates and industry engagement.'
                        };


                    const links = {
                        'Career Committee': 'https://www.bsu.edu/about/administrativeoffices/student-affairs/services-and-resources/parents-advisory-council',
                        'KEY Careers': 'https://www.bsu.edu/about/administrativeoffices/careercenter/programs-services/keycareers',
                        'Skills Infusion': 'https://www.bsu.edu/about/administrativeoffices/careercenter/programs-services/skills-infusion-program',
                        'Faculty Externships': 'https://www.bsu.edu/about/administrativeoffices/careercenter/programs-services/faculty-externship-program',
                        'Indiana Connection Lounge': 'https://www.bsu.edu/about/administrativeoffices/careercenter/indiana-connection-lounge',
                        'Practice Interview': 'https://www.bsu.edu/about/administrativeoffices/careercenter/programs-services/interview-assistance',
                        'On Campus Student Employment': 'https://www.bsu.edu/about/administrativeoffices/careercenter/student-employment',
                        'Competency Measures': 'https://www.naceweb.org/docs/default-source/default-document-library/2024/resources/nace-career-readiness-competencies-revised-apr-2024.pdf',
                        'Experience Journal': 'https://www.bsu.edu/experiencejournal',
                        'County Ambassadors': 'https://www.bsu.edu/about/administrativeoffices/governmental-relations/county-ambassador-program',
                        'Social Capital Building': 'https://magazine.bsu.edu/2024/10/01/enhancing-student-employer-engagement/',
                        'Job Fairs': 'https://www.bsu.edu/about/administrativeoffices/careercenter/job-fairs',
                        // Add more links as needed
                    };

                    const link = links[this.key] ? `<br><a href="${links[this.key]}" target="_blank" style="display: inline-block; text-align: center; width: 100%; margin: 0 auto;">Learn more</a>` : '';
                    return `<b>${this.key}</b><br>${additionalInfo[this.key] || ''}${link}`;
                }
            },
            
            xAxis: {
                visible: false,
                startOnTick: false,
                endOnTick: false
            },
            yAxis: {
                visible: false,
                startOnTick: false,
                endOnTick: false
            },
            series: [{
                name: 'Career Center Programs and Populations',
                showInLegend: false,
                marker: {
                    radius: 10,
                    symbol: 'circle',
                    lineWidth: 1,
                    lineColor: 'black'
                },
                dataLabels: {
                    enabled: true,
                    allowOverlap: true,
                    style: {
                        // textOutline: 'none',
                        fontSize: '0.875rem',
                    },
                    linkFormat: '', // Disable default link labels

                },
                accessibility: {
                    exposeAsGroupOnly: false,
                    description: 'Data points should be accessible'
                },                
                data: [],
                events: {
                    click: function (event) {
                        const nodeId = event.point.id;
                        console.log(nodeId);
                        console.log(this.chart.series);
                        let newData = [];
                        switch (nodeId) {
                            case 'Parents':
                                newData = [
                                    ['Parents', 'Career Committee', darkred]
                                ];
                                break;
                            case 'Employers':
                                newData = [
                                    ['Employers', 'Skills Infusion', darkred],
                                    ['Employers', 'Faculty Externships', darkred],
                                    ['Employers', 'Social Capital Building', darkred],
                                    ['Employers', 'Indiana Connection Lounge', darkred],
                                    ['Employers', 'Practice Interview', darkred],
                                    ['Employers', 'Job Fairs', darkred]
                                ];
                                break;
                            case 'Industry':
                                newData = [
                                    ['Industry', 'Skills Infusion', darkred],
                                    ['Industry', 'Faculty Externships', darkred],
                                    ['Industry', 'Social Capital Building', darkred],
                                    ['Industry', 'Indiana Connection Lounge', darkred],
                                    ['Industry', 'Practice Interview', darkred],
                                    ['Industry', 'Job Fairs', darkred]
                                ];
                                break;
                            case 'Alumni':
                                newData = [
                                    ['Alumni', 'Skills Infusion', darkred],
                                    ['Alumni', 'Faculty Externships', darkred],
                                    ['Alumni', 'Social Capital Building', darkred],
                                    ['Alumni', 'Practice Interview', darkred],
                                    ['Alumni', 'Job Fairs', darkred]
                                ];
                                break;
                            case 'Students':
                                newData = [
                                    ['Students', 'Experience Journal', darkred],
                                    ['Students', 'Social Capital Building', darkred],
                                    ['Students', 'Competency Measures', darkred],
                                    ['Students', 'Indiana Connection Lounge', darkred],
                                    ['Students', 'County Ambassadors', darkred],
                                    ['Students', 'Practice Interview', darkred],
                                    ['Students', 'On Campus Student Employment', darkred],
                                    ['Students', 'KEY Careers', darkred],
                                    ['Students', 'Job Fairs', darkred]
                                ];
                                break;
                            case 'Faculty':
                                newData = [
                                    ['Faculty', 'Faculty Externships', darkred],
                                    ['Faculty', 'Skills Infusion', darkred],
                                    ['Faculty', 'Experience Journal', darkred],
                                    ['Faculty', 'Indiana Connection Lounge', darkred],
                                    ['Faculty', 'Practice Interview', darkred]
                                ];
                                break;
                            case 'All Populations':
                                newData = [
                                    ['Faculty', 'Faculty Externships', darkred],
                                    ['Faculty', 'Skills Infusion', darkred],
                                    ['Faculty', 'Experience Journal', darkred],
                                    ['Faculty', 'Indiana Connection Lounge', darkred],
                                    ['Faculty', 'Practice Interview', darkred],
                                    ['Students', 'Experience Journal', darkred],
                                    ['Students', 'Social Capital Building', darkred],
                                    ['Students', 'Competency Measures', darkred],
                                    ['Students', 'Indiana Connection Lounge', darkred],
                                    ['Students', 'County Ambassadors', darkred],
                                    ['Students', 'Practice Interview', darkred],
                                    ['Students', 'On Campus Student Employment', darkred],
                                    ['Students', 'KEY Careers', darkred],
                                    ['Students', 'Job Fairs', darkred],
                                    ['Alumni', 'Skills Infusion', darkred],
                                    ['Alumni', 'Faculty Externships', darkred],
                                    ['Alumni', 'Social Capital Building', darkred],
                                    ['Alumni', 'Practice Interview', darkred],
                                    ['Alumni', 'Job Fairs', darkred],
                                    ['Industry', 'Skills Infusion', darkred],
                                    ['Industry', 'Faculty Externships', darkred],
                                    ['Industry', 'Social Capital Building', darkred],
                                    ['Industry', 'Indiana Connection Lounge', darkred],
                                    ['Industry', 'Practice Interview', darkred],
                                    ['Industry', 'Job Fairs', darkred],
                                    ['Employers', 'Skills Infusion', darkred],
                                    ['Employers', 'Faculty Externships', darkred],
                                    ['Employers', 'Social Capital Building', darkred],
                                    ['Employers', 'Indiana Connection Lounge', darkred],
                                    ['Employers', 'Practice Interview', darkred],
                                    ['Employers', 'Job Fairs', darkred],
                                    ['Parents', 'Career Committee', darkred],
                                    ['Parents', 'Students', darkred]

                                ];
                                break;
                            default:
                                return;
                        }

                        if (this.chart.series && this.chart.series[0]) {
                            this.chart.series[0].setData(newData);
                        } else {
                            console.error('Series data is not available.');
                        }
                    }
                },
                nodes: [
                    // Population nodes (red) positioned in outer circle
                    { name: 'Faculty', id: 'Faculty', color: card, x: -250, y: -150 },
                    { name: 'Students', id: 'Students', color: card, x: 0, y: -300 },
                    { name: 'Alumni', id: 'Alumni', color: card, x: 250, y: -150 },
                    { name: 'Employers', id: 'Employers', color: card, x: 250, y: 150 },
                    { name: 'Industry', id: 'Industry', color: card, x: 0, y: 300 },
                    { name: 'Parents', id: 'Parents', color: card, x: -250, y: 150 },
                    { name: 'All Populations', id: 'All Populations', color: darkred, x: -400, y: 0 },

                    // Program nodes (gray) - let them position naturally in the center
                    { name: 'Career Committee', id: 'Career Committee', color: lgray },
                    { name: 'Skills Infusion', id: 'Skills Infusion', color: lgray },
                    { name: 'Faculty Externships', id: 'Faculty Externships', color: lgray },
                    { name: 'Experience Journal', id: 'Experience Journal', color: lgray },
                    { name: 'Social Capital Building', id: 'Social Capital Building', color: lgray },
                    { name: 'Competency Measures', id: 'Competency Measures', color: lgray },
                    { name: 'Indiana Connection Lounge', id: 'Indiana Connection Lounge', color: lgray },
                    { name: 'County Ambassadors', id: 'County Ambassadors', color: lgray },
                    { name: 'Practice Interview', id: 'Practice Interview', color: lgray },
                    { name: 'On Campus Student Employment', id: 'On Campus Student Employment', color: lgray },
                    { name: 'KEY Careers', id: 'KEY Careers', color: lgray },
                    { name: 'Job Fairs', id: 'Job Fairs', color: lgray }
                ],
            },
            ...colorLegend.map((entry, i) => ({
                // use an inert series type so nothing renders
                type: 'scatter',
                name: entry.name,
                color: entry.color,
                showInLegend: true,
                enableMouseTracking: false,
                data: [],             // no points -> legend only
                marker: {
                    symbol: 'circle',
                    radius: 6
                },
                legendIndex: i,

            }))
            ],
            
            
        });

    </script>
</body>
</html>
